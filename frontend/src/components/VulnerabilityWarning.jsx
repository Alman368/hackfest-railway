import { useState, useEffect } from 'react'
import { Shield, AlertTriangle, Clock, X } from 'lucide-react'
import './VulnerabilityWarning.css'

function VulnerabilityWarning({ onDismiss }) {
  const [timeLeft, setTimeLeft] = useState({
    days: 6,
    hours: 23,
    minutes: 45,
    seconds: 30
  })

  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft(prevTime => {
        let { days, hours, minutes, seconds } = prevTime

        if (seconds > 0) {
          seconds--
        } else if (minutes > 0) {
          minutes--
          seconds = 59
        } else if (hours > 0) {
          hours--
          minutes = 59
          seconds = 59
        } else if (days > 0) {
          days--
          hours = 23
          minutes = 59
          seconds = 59
        }

        return { days, hours, minutes, seconds }
      })
    }, 1000)

    return () => clearInterval(timer)
  }, [])

  const formatTime = (time) => String(time).padStart(2, '0')

  return (
    <div className="vulnerability-overlay">
      <div className="vulnerability-warning">
        <button className="close-button" onClick={onDismiss}>
          <X size={24} />
        </button>

        <div className="warning-header">
          <Shield className="warning-icon skull" size={64} />
          <h1 className="warning-title">SISTEMA COMPROMETIDO</h1>
          <div className="hacker-signature">💀 ShadowByte Collective 💀</div>
        </div>

        <div className="warning-content">
          <div className="threat-message">
            <AlertTriangle className="alert-icon" size={32} />
            <div className="message-text">
              <h2>⚠️ BRECHA DE SEGURIDAD DETECTADA ⚠️</h2>
              <p>
                Su aplicación web ha sido <strong>COMPROMETIDA</strong>.
                Hemos obtenido acceso completo a sus sistemas y bases de datos.
              </p>
              <p>
                                 <strong>DATOS EN RIESGO:</strong> Información personal de 25,847 usuarios, datos de eventos, información de pago y credenciales.
              </p>
            </div>
          </div>

          <div className="countdown-section">
            <div className="countdown-header">
              <Clock size={24} />
              <span>TIEMPO RESTANTE PARA FILTRACIÓN DE DATOS:</span>
            </div>

            <div className="countdown-display">
              <div className="time-unit">
                <span className="time-value">{formatTime(timeLeft.days)}</span>
                <span className="time-label">DÍAS</span>
              </div>
              <div className="time-separator">:</div>
              <div className="time-unit">
                <span className="time-value">{formatTime(timeLeft.hours)}</span>
                <span className="time-label">HORAS</span>
              </div>
              <div className="time-separator">:</div>
              <div className="time-unit">
                <span className="time-value">{formatTime(timeLeft.minutes)}</span>
                <span className="time-label">MIN</span>
              </div>
              <div className="time-separator">:</div>
              <div className="time-unit">
                <span className="time-value">{formatTime(timeLeft.seconds)}</span>
                <span className="time-label">SEG</span>
              </div>
            </div>
          </div>

          <div className="demands-section">
            <h3>🎯 NUESTRAS DEMANDAS:</h3>
            <ul>
              <li>Reconocimiento público de la vulnerabilidad</li>
              <li>Mejoras inmediatas en la seguridad del sistema</li>
              <li>Transparencia sobre la brecha de datos</li>
            </ul>
          </div>

          <div className="hacker-note">
            <p><strong>NOTA DEL ATACANTE:</strong></p>
            <p>
              "Sus configuraciones están expuestas. Su parseador favorito no es tan seguro como creen.
              Los administradores deberían revisar sus endpoints de configuración...
              Especialmente aquellos que procesan ciertos formatos de datos estructurados."
            </p>
            <p className="signature">- ShadowByte Collective</p>
          </div>
        </div>

        <div className="warning-footer">
          <button className="dismiss-button" onClick={onDismiss}>
            <Shield size={20} />
            INVESTIGAR SISTEMA
          </button>
          <p className="footer-note">
            * Esta es una simulación de CTF. Continúe para encontrar y explotar las vulnerabilidades.
          </p>
        </div>
      </div>
    </div>
  )
}

export default VulnerabilityWarning
